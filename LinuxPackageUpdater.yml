---
- hosts: all

  become: true

  tasks:
    - name: APT Package Updater
      apt:
        upgrade: yes
        update_cache: yes
    - name: check if system reboot is required
      become: true
      stat:
        path: /var/run/reboot-required
      register: reboot_required
    - name: hostname
      command: hostname
      register: hostname_host
      
    - name: Send update completion notification
      mail:
        host: smtp.gmail.com
        port: 587
        username: workgcannon@gmail.com
        password: "xscj expv qrzi zbay"
        to: workgcannon@gmail.com
        subject: "\n\n{{ hostname_host.stdout }}"
        body: "APT Package Updater \n\n{{ reboot_required.stdout }}"
      vars:
        ansible_python_interpreter: /usr/bin/python3
      delegate_to: localhost
