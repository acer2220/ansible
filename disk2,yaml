---
- hosts: all

  become: true
  tasks:

    - name: Get disk usage
      command: df -h
      register: disk_usage

    - name: Check disk space available
      shell: df -h / | awk 'NR==2 {print $5}'
      register: disk_usag

    - name: Send update completion notification
          mail:
            host: smtp.gmail.com
            port: 587
            username: workgcannon@gmail.com
            password: "xscj expv qrzi zbay"
            to: workgcannon@gmail.com
            subject: "Disk Space Usage"
            body: '{"content": "Disk space on {{ inventory_hostname }} is above 10%!"}'
          when: disk_usage.stdout[:-1]|int > 10
          vars:
            ansible_python_interpreter: /usr/bin/python3
          delegate_to: localhost
